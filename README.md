# inflearn_JPA

### 인프런 JPA 수강 코드

API 개발 고급 정리

* 엔티티 조회
  * 엔티티를 그대로 조회해서 반환 : v1 → X (사용 금지)
  * 엔티티 조회 후 DTO로 변환 : v2
  * 페치 조인으로 쿼리 수 최적화 : v3
  * 컬렉션 페이징과 한계 돌파 : v3.1
    * 컬렉션은 페치 조인시 페이징이 불가능
    * xToOne 관계는 페치 조인으로 쿼리 수 최적화 가능
    * 컬렉션은 페치 조인 대신에 지연 로딩을 유지하고, 배치사이즈 옵션을 통해 최적화

* DTO 직접 조회
  * JPA(Repository)에서 DTO를 직접 조회 : v4 (select에 new DTO()사용)
  * 컬렉션 조회 최적화 : v5 (일대다 관계인 컬렉션은 IN절을 활용해서 메모리에 미리 조회해서 최적화)
  * 플랫 데이터 최적화 : v6 (JOIN 결과를 그대로 조회 후 애플리케이션에서 원하는 모양으로 직접 변환)


###  최적화 적용 권장 순서
> * 엔티티 조회 방식으로 우선 접근
>   1. 페치조인으로 쿼리 수를 최적화
>   2. 컬렉션 최적화
>      1. 페이징 필요하면 @BatchSize로 최적화
>      2. 페이징 필요하지 않다면 fetch join으로 한방쿼리 사용
> * 엔티티 조회 방식으로 해결이 안되면 DTO 조회 방식을 사용
> * DTO 조회 방식으로도 안되면 Native SQL 또는 스프링 JdbcTemplate 활용